#!/bin/sh
# chkconfig: 2345 95 20
# description: Some description
# What your script does (not sure if this is necessary though)
# processname: myscript
# Source function library.
. /etc/init.d/functions

pname="lazylogin"
direxe="/root"
securityoptions="-Djavax.net.ssl.keyStore=<%=node[:lazylogin][:security][:keystore][:loc]%> -Djavax.net.ssl.keyStorePassword=<%=node[:lazylogin][:security][:keystore][:password]%> -Djavax.net.ssl.trustStore=<%=node[:lazylogin][:security][:truststore][:loc]%> -Djavax.net.ssl.trustStorePassword=<%=node[:lazylogin][:security][:truststore][:password]%>"
metrics="-Dnavid.plugins.metrics.mqurl=<%=node[:navid][:plugin][:metrics][:mqurl]%> -Dnavid.plugins.metrics.enabled=<%=node[:navid][:plugin][:metrics][:enabled]%>"
jmxoptions="-Dcom.sun.management.jmxremote.port=2001 -Dcom.sun.management.jmxremote.rmi.port=2000 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false"
exe="java $jmxoptions $securityoptions $metrics -jar /root/springboot.war"
pidfile="/var/run/${pname}.pid"
lockfile="/var/lock/subsys/${pname}"
logfile="/var/log/lazylogin.log"
errfile="/var/log/lazylogin.err"

RETVAL=0

#[ -x $exe ] || exit 0

start() {
    echo -n "Starting $pname : "
    #daemon ${exe} # Not working ...
    if [ -s ${pidfile} ]; then
       RETVAL=1
       echo -n "Already running !" && warning
       echo
    else
       cd ${direxe}
       nohup ${exe} >>${logfile} 2>>${errfile} &
       RETVAL=$?
       PID=$!
       [ $RETVAL -eq 0 ] && touch ${lockfile} && success || failure
       echo
       echo $PID > ${pidfile}
    fi
}

stop() {
    echo -n "Shutting down $pname with PID `cat ${pidfile}`: "
    killproc -p ${pidfile}
    RETVAL=$?
    echo
    if [ $RETVAL -eq 0 ]; then
        rm -f ${lockfile}
        rm -f ${pidfile}
    fi
}

restart() {
    echo -n "Restarting $pname : "
    stop
    sleep 2
    start
}

case "$1" in
    start)
        start
    ;;
    stop)
        stop
    ;;
    status)
        status ${pname}
    ;;
    restart)
        restart
    ;;
    *)
        echo "Usage: $0 {start|stop|status|restart}"
    ;; esac

exit 0